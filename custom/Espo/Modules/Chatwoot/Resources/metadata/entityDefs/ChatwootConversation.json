{
    "deleteId": true,
    "fields": {
        "deleteId": {
            "type": "varchar",
            "maxLength": 17,
            "default": "0",
            "readOnly": true
        },
        "name": {
            "type": "varchar",
            "maxLength": 255,
            "readOnly": true
        },
        "chatwootConversationId": { "type": "int", "required": true },
        "chatwootAccountIdExternal": {
            "type": "foreign",
            "link": "chatwootAccount",
            "field": "chatwootAccountId",
            "readOnly": true
        },
        "contactInbox": { "type": "link" },
        "inbox": { "type": "link" },
        "chatwootContact": { "type": "link" },
        "contact": { "type": "link" },
        "chatwootAccount": { "type": "link", "required": true },
        "status": {
            "type": "enum",
            "options": ["open", "pending", "snoozed", "resolved"],
            "default": "open"
        },
        "chatwootInboxId": { "type": "int" },
        "inboxName": { "type": "varchar", "maxLength": 255 },
        "assigneeId": { "type": "int" },
        "assigneeName": { "type": "varchar", "maxLength": 255 },
        "lastActivityAt": { "type": "datetime" },
        "chatwootCreatedAt": { "type": "datetime" },
        "messagesCount": {
            "type": "int",
            "default": 0,
            "readOnly": true
        },
        "lastSyncedAt": { "type": "datetime", "readOnly": true },
        "lastMessageContent": {
            "type": "text",
            "readOnly": true,
            "tooltip": true
        },
        "lastMessageType": {
            "type": "enum",
            "options": ["incoming", "outgoing", "activity", "template"],
            "readOnly": true
        },
        "contactAvatarUrl": {
            "type": "text",
            "readOnly": true,
            "tooltip": true
        },
        "contactDisplayName": {
            "type": "varchar",
            "maxLength": 255,
            "readOnly": true
        },
        "contactPhoneNumber": {
            "type": "varchar",
            "maxLength": 50,
            "readOnly": true
        },
        "inboxChannelType": {
            "type": "varchar",
            "maxLength": 100,
            "readOnly": true
        },
        "opportunities": {
            "type": "linkMultiple",
            "columns": {
                "stage": "stage"
            }
        },
        "cAgendamentos": {
            "type": "linkMultiple",
            "columns": {
                "status": "status",
                "dateStart": "dateStart"
            }
        },
        "assignedUser": {
            "type": "link",
            "view": "views/fields/assigned-user"
        },
        "cases": {
            "type": "linkMultiple",
            "columns": {
                "status": "status",
                "priority": "priority"
            }
        },
        "appointments": {
            "type": "linkMultiple",
            "columns": {
                "status": "status",
                "dateStart": "dateStart"
            }
        },
        "smartAudiences": {
            "type": "linkMultiple",
            "layoutListDisabled": true,
            "layoutDetailDisabled": true,
            "layoutMassUpdateDisabled": true,
            "noLoad": true
        },
        "teams": {
            "type": "linkMultiple",
            "view": "views/fields/teams",
            "required": true,
            "readOnly": true
        }
    },
    "links": {
        "contactInbox": {
            "type": "belongsTo",
            "entity": "ChatwootContactInbox",
            "foreign": "conversations"
        },
        "chatwootContact": {
            "type": "belongsTo",
            "entity": "ChatwootContact",
            "foreign": "conversations"
        },
        "contact": {
            "type": "belongsTo",
            "entity": "Contact",
            "foreign": "chatwootConversations"
        },
        "chatwootAccount": {
            "type": "belongsTo",
            "entity": "ChatwootAccount",
            "foreign": "conversations"
        },
        "opportunities": {
            "type": "hasMany",
            "entity": "Opportunity",
            "foreign": "chatwootConversations",
            "relationName": "chatwootConversationOpportunity"
        },
        "cAgendamentos": {
            "type": "hasMany",
            "entity": "CAgendamento",
            "foreign": "chatwootConversations",
            "relationName": "chatwootConversationCAgendamento"
        },
        "cases": {
            "type": "hasMany",
            "entity": "Case",
            "foreign": "chatwootConversations",
            "relationName": "chatwootConversationCase"
        },
        "appointments": {
            "type": "hasMany",
            "entity": "Appointment",
            "foreign": "chatwootConversations",
            "relationName": "chatwootConversationAppointment"
        },
        "tasks": {
            "type": "hasChildren",
            "entity": "Task",
            "foreign": "parent"
        },
        "inbox": {
            "type": "belongsTo",
            "entity": "ChatwootInbox",
            "foreign": "conversations"
        },
        "messages": {
            "type": "hasMany",
            "entity": "ChatwootMessage",
            "foreign": "conversation"
        },
        "assignedUser": {
            "type": "belongsTo",
            "entity": "User"
        },
        "teams": {
            "type": "hasMany",
            "entity": "Team",
            "relationName": "entityTeam",
            "layoutRelationshipsDisabled": true
        },
        "smartAudiences": {
            "type": "hasMany",
            "entity": "SmartAudience",
            "relationName": "smartAudienceConversation",
            "foreign": "conversations",
            "additionalColumns": {
                "isActive": {
                    "type": "bool",
                    "default": true
                },
                "reasoningMatches": {
                    "type": "bool"
                },
                "reasoningConfidence": {
                    "type": "float"
                },
                "reasoningExplanation": {
                    "type": "text"
                },
                "addedAt": {
                    "type": "datetime"
                },
                "removedAt": {
                    "type": "datetime"
                },
                "lastEvaluatedAt": {
                    "type": "datetime"
                },
                "userOverride": {
                    "type": "varchar",
                    "len": 20
                },
                "userOverrideReason": {
                    "type": "text"
                }
            }
        }
    },
    "indexes": {
        "uniqueConversation": {
            "unique": true,
            "columns": ["chatwootConversationId", "chatwootAccountId", "deleteId"]
        },
        "lastActivityAt": {
            "columns": ["lastActivityAt"]
        }
    },
    "collection": {
        "orderBy": "lastActivityAt",
        "order": "desc",
        "textFilterFields": ["name", "contactDisplayName", "contactPhoneNumber", "messages.content"]
    },
    "cascadeDelete": {
        "links": ["messages"],
        "junctionTables": [
            {"table": "SmartAudienceConversation", "column": "chatwootConversationId"},
            {"table": "ChatwootConversationOpportunity", "column": "chatwootConversationId"},
            {"table": "ChatwootConversationOpportunity", "column": "chatwootConversationId"},
            {"table": "ChatwootConversationCAgendamento", "column": "chatwootConversationId"},
            {"table": "ChatwootConversationCase", "column": "chatwootConversationId"},
            {"table": "ChatwootConversationAppointment", "column": "chatwootConversationId"}
        ]
    }
}

